{"version":3,"sources":["../src/index.ts","../src/useTable/index.ts","../src/utils/useIsFirstRender/index.ts"],"sourcesContent":["export { useTable } from \"./useTable\";\nexport type { UseTableProps, UseTableReturnType } from \"./useTable\";\n","import { useEffect } from \"react\";\nimport {\n    BaseRecord,\n    CrudOperators,\n    HttpError,\n    LogicalFilter,\n    useTable as useTableCore,\n    useTableProps as useTablePropsCore,\n    useTableReturnType as useTableReturnTypeCore,\n} from \"@refinedev/core\";\nimport {\n    useReactTable,\n    TableOptions,\n    Table,\n    getCoreRowModel,\n    ColumnFilter,\n} from \"@tanstack/react-table\";\n\nimport { useIsFirstRender } from \"../utils\";\n\nexport type UseTableReturnType<\n    TData extends BaseRecord = BaseRecord,\n    TError extends HttpError = HttpError,\n> = Table<TData> & {\n    refineCore: useTableReturnTypeCore<TData, TError>;\n};\n\nexport type UseTableProps<\n    TData extends BaseRecord = BaseRecord,\n    TError extends HttpError = HttpError,\n> = {\n    /**\n     * Configuration object for the core of the [useTable](/docs/api-reference/core/hooks/useTable/)\n     * @type [`useTablePropsCore<TData, TError>`](/docs/api-reference/core/hooks/useTable/#properties)\n     */\n    refineCoreProps?: useTablePropsCore<TData, TError>;\n} & Pick<TableOptions<TData>, \"columns\"> &\n    Partial<Omit<TableOptions<TData>, \"columns\">>;\n\nexport function useTable<\n    TData extends BaseRecord = BaseRecord,\n    TError extends HttpError = HttpError,\n>({\n    refineCoreProps: { hasPagination = true, ...refineCoreProps } = {},\n    initialState: reactTableInitialState = {},\n    ...rest\n}: UseTableProps<TData, TError>): UseTableReturnType<TData, TError> {\n    const isFirstRender = useIsFirstRender();\n\n    const useTableResult = useTableCore<TData, TError>({\n        ...refineCoreProps,\n        hasPagination,\n    });\n\n    const hasPaginationString = hasPagination === false ? \"off\" : \"server\";\n    const isPaginationEnabled =\n        (refineCoreProps.pagination?.mode ?? hasPaginationString) !== \"off\";\n\n    const {\n        tableQueryResult: { data },\n        current,\n        setCurrent,\n        pageSize: pageSizeCore,\n        setPageSize: setPageSizeCore,\n        sorters,\n        setSorters,\n        filters: filtersCore,\n        setFilters,\n        pageCount,\n    } = useTableResult;\n\n    const logicalFilters: LogicalFilter[] = [];\n    filtersCore.forEach((filter) => {\n        if (\n            filter.operator !== \"or\" &&\n            filter.operator !== \"and\" &&\n            \"field\" in filter\n        ) {\n            logicalFilters.push(filter);\n        }\n    });\n\n    const reactTableResult = useReactTable<TData>({\n        getCoreRowModel: getCoreRowModel(),\n        data: data?.data ?? [],\n        initialState: {\n            pagination: {\n                pageIndex: current - 1,\n                pageSize: pageSizeCore,\n            },\n            sorting: sorters.map((sorting) => ({\n                id: sorting.field,\n                desc: sorting.order === \"desc\",\n            })),\n            columnFilters: logicalFilters.map((filter) => ({\n                id: filter.field,\n                operator: filter.operator as Exclude<\n                    CrudOperators,\n                    \"or\" | \"and\"\n                >,\n                value: filter.value,\n            })),\n            ...reactTableInitialState,\n        },\n        pageCount,\n        manualPagination: true,\n        manualSorting: true,\n        manualFiltering: true,\n        ...rest,\n    });\n\n    const { state, columns } = reactTableResult.options;\n    const { pagination, sorting, columnFilters } = state;\n\n    const { pageIndex, pageSize } = pagination ?? {};\n\n    useEffect(() => {\n        if (pageIndex !== undefined) {\n            setCurrent(pageIndex + 1);\n        }\n    }, [pageIndex]);\n\n    useEffect(() => {\n        if (pageSize !== undefined) {\n            setPageSizeCore(pageSize);\n        }\n    }, [pageSize]);\n\n    useEffect(() => {\n        if (sorting !== undefined) {\n            setSorters(\n                sorting?.map((sorting) => ({\n                    field: sorting.id,\n                    order: sorting.desc ? \"desc\" : \"asc\",\n                })),\n            );\n\n            if (sorting.length > 0 && isPaginationEnabled && !isFirstRender) {\n                setCurrent(1);\n            }\n        }\n    }, [sorting]);\n\n    useEffect(() => {\n        const crudFilters: LogicalFilter[] = [];\n\n        columnFilters?.map((filter) => {\n            const operator =\n                (\n                    filter as ColumnFilter & {\n                        operator?: Exclude<CrudOperators, \"or\" | \"and\">;\n                    }\n                ).operator ??\n                ((columns.find((c) => c.id === filter.id) as any)?.meta\n                    ?.filterOperator as Exclude<CrudOperators, \"or\" | \"and\">);\n\n            crudFilters.push({\n                field: filter.id,\n                operator:\n                    operator ?? (Array.isArray(filter.value) ? \"in\" : \"eq\"),\n                value: filter.value,\n            });\n        });\n\n        const filteredArray = logicalFilters.filter(\n            (value) =>\n                !crudFilters.some(\n                    (b) =>\n                        value.field === b.field &&\n                        value.operator === b.operator,\n                ),\n        );\n\n        filteredArray?.map((filter) => {\n            crudFilters.push({\n                field: filter.field,\n                operator: filter.operator,\n                value: undefined,\n            });\n        });\n\n        setFilters(crudFilters);\n\n        if (crudFilters.length > 0 && isPaginationEnabled && !isFirstRender) {\n            setCurrent(1);\n        }\n    }, [columnFilters]);\n\n    return {\n        ...reactTableResult,\n        refineCore: useTableResult,\n    };\n}\n","import { useEffect, useRef } from \"react\";\n\nexport const useIsFirstRender = () => {\n    const firstRender = useRef(true);\n\n    useEffect(() => {\n        firstRender.current = false;\n    }, []);\n\n    return firstRender.current;\n};\n"],"mappings":"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","names":["src_exports","__export","useTable","__toCommonJS","import_react","import_core","import_react_table","import_react","useIsFirstRender","firstRender","useTable","hasPagination","refineCoreProps","reactTableInitialState","rest","_a","_b","_c","isFirstRender","useIsFirstRender","useTableResult","useTableCore","hasPaginationString","isPaginationEnabled","data","current","setCurrent","pageSizeCore","setPageSizeCore","sorters","setSorters","filtersCore","setFilters","pageCount","logicalFilters","filter","reactTableResult","sorting","state","columns","pagination","columnFilters","pageIndex","pageSize","crudFilters","operator","c","filteredArray","value","b"]}